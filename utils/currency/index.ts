import { getDaysDiff, getAbsDate } from "@/utils";

let currencyRates = {
  success: true,
  timestamp: 1679159402,
  base: "USD",
  date: "2023-03-18",
  rates: {
    AED: 3.672904,
    AFN: 86.239043,
    ALL: 106.395807,
    AMD: 382.728074,
    ANG: 1.777005,
    AOA: 504.801041,
    ARS: 200.102129,
    AUD: 1.493429,
    AWG: 1.8,
    AZN: 1.70397,
    BAM: 1.814202,
    BBD: 1.99091,
    BDT: 105.746487,
    BGN: 1.824867,
    BHD: 0.371968,
    BIF: 2050.554241,
    BMD: 1,
    BND: 1.324243,
    BOB: 6.813228,
    BRL: 5.279404,
    BSD: 0.98604,
    BTC: 3.6523621e-5,
    BTN: 81.43036,
    BWP: 13.085664,
    BYN: 2.488846,
    BYR: 19600,
    BZD: 1.987477,
    CAD: 1.37705,
    CDF: 2052.000362,
    CHF: 0.923178,
    CLF: 0.029531,
    CLP: 814.841612,
    CNY: 6.887204,
    COP: 4764.714067,
    CRC: 535.411159,
    CUC: 1,
    CUP: 26.5,
    CVE: 102.27726,
    CZK: 22.49804,
    DJF: 175.55772,
    DKK: 6.980304,
    DOP: 54.04202,
    DZD: 134.803581,
    EGP: 30.478178,
    ERN: 15,
    ETB: 53.087519,
    EUR: 0.93005,
    FJD: 2.21104,
    FKP: 0.82366,
    GBP: 0.821187,
    GEL: 2.57504,
    GGP: 0.82366,
    GHS: 12.275868,
    GIP: 0.82366,
    GMD: 61.503853,
    GNF: 8491.257363,
    GTQ: 7.690738,
    GYD: 208.051575,
    HKD: 7.85005,
    HNL: 24.318909,
    HRK: 7.018274,
    HTG: 152.386253,
    HUF: 372.960388,
    IDR: 15374,
    ILS: 3.66689,
    IMP: 0.82366,
    INR: 82.540504,
    IQD: 1439.07982,
    IRR: 42250.000352,
    ISK: 140.150386,
    JEP: 0.82366,
    JMD: 149.584899,
    JOD: 0.709904,
    JPY: 131.84504,
    KES: 127.192616,
    KGS: 87.420385,
    KHR: 3998.886879,
    KMF: 461.740384,
    KPW: 900.042443,
    KRW: 1308.750384,
    KWD: 0.30686,
    KYD: 0.821669,
    KZT: 451.964195,
    LAK: 16644.868049,
    LBP: 14800.148416,
    LKR: 334.27021,
    LRD: 161.050382,
    LSL: 18.420382,
    LTL: 2.95274,
    LVL: 0.60489,
    LYD: 4.754881,
    MAD: 10.211307,
    MDL: 18.388757,
    MGA: 4238.207875,
    MKD: 57.154121,
    MMK: 2070.590418,
    MNT: 3540.840133,
    MOP: 7.972543,
    MRO: 356.999828,
    MUR: 45.998701,
    MVR: 15.403741,
    MWK: 1032.326887,
    MXN: 18.914039,
    MYR: 4.485504,
    MZN: 63.103732,
    NAD: 18.420377,
    NGN: 460.440377,
    NIO: 36.065118,
    NOK: 10.70247,
    NPR: 130.288948,
    NZD: 1.597062,
    OMR: 0.38498,
    PAB: 0.98604,
    PEN: 3.736561,
    PGK: 3.474792,
    PHP: 54.725039,
    PKR: 277.81012,
    PLN: 4.40835,
    PYG: 7110.05983,
    QAR: 3.641038,
    RON: 4.615204,
    RSD: 109.995038,
    RUB: 76.960373,
    RWF: 1079.263485,
    SAR: 3.754318,
    SBD: 8.200165,
    SCR: 13.902038,
    SDG: 593.503678,
    SEK: 10.639965,
    SGD: 1.341504,
    SHP: 1.21675,
    SLE: 20.595511,
    SLL: 19750.000338,
    SOS: 569.503664,
    SRD: 34.799504,
    STD: 20697.981008,
    SVC: 8.627615,
    SYP: 2512.023722,
    SZL: 18.103056,
    THB: 34.076038,
    TJS: 10.747553,
    TMT: 3.5,
    TND: 3.129038,
    TOP: 2.36005,
    TRY: 19.020904,
    TTD: 6.691712,
    TWD: 30.633038,
    TZS: 2307.314132,
    UAH: 36.415751,
    UGX: 3694.63383,
    USD: 1,
    UYU: 39.005612,
    UZS: 11215.620797,
    VEF: 2407079.31584,
    VES: 24.095671,
    VND: 23590,
    VUV: 119.733327,
    WST: 2.73297,
    XAF: 608.506099,
    XAG: 0.044256,
    XAU: 0.000503,
    XCD: 2.70255,
    XDR: 0.742915,
    XOF: 608.506099,
    XPF: 112.250364,
    YER: 250.303593,
    ZAR: 18.783525,
    ZMK: 9001.203589,
    ZMW: 20.238393,
    ZWL: 321.999592,
  },
};

export const getCurrencyExchangeRates = async () => {
  if (
    getDaysDiff(
      getAbsDate(new Date(currencyRates.date)),
      getAbsDate(new Date())
    ) < 1
  )
    return currencyRates.rates;

  let response;
  try {
    response = await fetch(
      "https://api.apilayer.com/exchangerates_data/latest?base=USD",
      {
        method: "GET",
        headers: { apiKey: "krahLWkI5rACWplDnp6UdkPdZjYWi6Wk" },
      }
    );
    if ((response as Response).status !== 200) throw new Error('Throw in call to exchangerates')
    response = await response.json();
    currencyRates = response;
  } catch (e) {
    console.log("❌ Something went wrong fetching currencyExchanges", {
      e,
      response,
    });
  }
  return currencyRates.rates;
};
